import React from"react";import Link from"next/link";import Styles from"./Notifications.module.scss";import PresentationStyles from"../presentation/Presentation.module.scss";import{fireGlobalEvent}from"../utility/utility";import{resolveMainLink}from"../presentation/utility";const Module=a=>{const[e,t]=React.useState(!1);var[n,,]=React.useState(!1),[,,]=React.useState(null);const[c,i]=React.useState(null),[s,,]=React.useState([]),[l,r]=React.useState(!1),[o,u]=React.useState(!1),[m,d]=React.useState(!1),f=React.useRef(),p=React.useRef(),g=(React.useEffect(()=>{e||(f.current.addEventListener("mouseover",g),t(!0))},[e]),()=>{a._LocalEventEmitter.dispatch("notification",{dispatch:"mouseOver"})}),R=(a._LocalEventEmitter.unsubscribe("notification"),a._LocalEventEmitter.subscribe("notification",e=>{[...s];e&&(console.log("Notification Update",e),"notification"===e.dispatch?(r(!0),a.passOveride&&a.passOveride("notifications"),setTimeout(()=>{r(!1)},1500)):"mouseOver"===e.dispatch&&(console.log("Did mouse over",a,m),"notifications"===a?._openMenu?.currentMenu)&&!m&&a._toggleSingleOpenMenu&&a._toggleSingleOpenMenu(null,"notifications",!0))}),React.useEffect(()=>{var e;"notifications"!==a?._openMenu?.currentMenu&&!l||o?"notifications"!==a?._openMenu?.currentMenu&&!l&&o&&(d(!0),e=setTimeout(()=>{d(!1),u(!1),p.current=null},500),p.current=e):(u(!0),d(!1),p?.current&&clearTimeout(p.current))},[a?._openMenu?.currentMenu,m,o,p?.current]),React.useEffect(()=>{a?.notificationsData&&i(a.notificationsData)},[a?.notificationsData]),React.useCallback(e=>{d(!0),a._toggleSingleOpenMenu(null,"notifications",!1)})),E=React.useCallback(async e=>{e?.currentTarget?.getAttribute("ctaAfter")&&(e.currentTarget.innerHTML=e.currentTarget.getAttribute("ctaAfter")),fireGlobalEvent(e,a._LocalEventEmitter)}),v=e=>{var t;if(e&&a?.cdn?.static&&0<e?.product?.images?.length)return(t=e.product.images.find(e=>e.leadImg??!1))?a.cdn.static+"/"+t.name:a.cdn.static+"/"+e.product.images[0].name;return""};return React.createElement(React.Fragment,null,React.createElement("div",{className:`Misc_Container Misc_Container_Bigger ${a.className} `+(a.open||o&&!m?"Misc_Container_Visible":""),ref:f,style:{top:a?.menuConfig?.height&&!isNaN(Number(a.menuConfig.height))?Number(a.menuConfig.height)+"px":""}},a.open||o?React.createElement(React.Fragment,null,React.createElement("div",{className:n?"fetchNotBusy fetchBusy":"fetchNotBusy"}),React.createElement("div",{className:"Misc_Internal_Container",style:{paddingTop:".5rem",paddingBottom:".5rem"}},React.createElement("h5",{className:"Misc_Label",style:{marginTop:0}},"Notifications"),React.createElement("div",null,c?.notifications?.map?c.notifications.map(e=>React.createElement("div",{className:""+Styles.notifContainer},React.createElement("div",{className:""+Styles.notifInternalContainer},React.createElement("div",{className:""+Styles.detailContainer},React.createElement("div",{className:Styles.author+" Misc_P"},e?.meta?.fromAdmin&&a?.siteTitle?a.siteTitle:null),e?.meta?.verb?React.createElement("span",{className:"Misc_P"},e.meta.verb):null,React.createElement("div",{className:"Misc_P"},e?.meta?.quotes?'"':"",e?.meta?.message??null,e?.meta?.quotes?'"':"")),React.createElement("div",null,e?.meta?.image&&a?.cdn?.static?React.createElement("div",{className:""+Styles.icon,style:{background:`url(${a.cdn.static}/${e.meta.image})`,backgroundSize:"contain"}}):e?.meta?.icon?React.createElement("div",{className:""+Styles.icon,style:{background:`url(${a.cdn.static}/${e.meta.icon})`,backgroundSize:"contain"}}):null)),e?.product?React.createElement("div",{className:`${Styles.notifBox} ${Styles.notifProduct} flex gap-p5`},React.createElement("div",null,React.createElement("div",{className:""+Styles.notifImageContainer,style:{backgroundImage:v(e)?`url(${v(e)})`:null}},React.createElement("img",{src:"img/default/greythumb_product.jpg",className:"Product_img",style:{width:"75px",maxHeight:"60px",opacity:v(e)?0:1}}))),React.createElement("div",null,React.createElement(Link,{href:resolveMainLink(e?.product),onClick:R},React.createElement("div",{className:Styles.productName+" "+(a?.classes?.productName??""),style:{fontSize:".9rem",fontWeight:"600"}},e?.product?.name)),React.createElement("button",{className:PresentationStyles.CtaButton+" "+a.ctaClassName,onClick:E,action:"add_to_cart",item:e?.product?.id,selectedstyle:e?.meta?.productStyle,currentoption:e?.meta?.productOption,ctaAfter:"Added To Cart"},"Add To Cart"))):null)):React.createElement("div",null,React.createElement("div",{className:"Misc_P"},"All Caught Up"))))):null))};export default Module;