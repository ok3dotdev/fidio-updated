import React from"react";import{v4 as uuidv4}from"uuid";import TextareaAutosize from"react-textarea-autosize";import ChatStyles from"/modules/streaming/chat/Chat.module.scss";import{handleKeyPressChat}from"../../streaming/chat/utility";import WatchPageStyles from"/modules/streaming/watch/WatchPage.module.scss";const Module=l=>{const[e,a]=React.useState(!1),[c,n]=React.useState(null),[t,r]=React.useState(null),[s,o]=React.useState(null);var[m,,]=React.useState(!1),[,,]=React.useState(!1);const[u,i]=React.useState(!1),d=React.useRef(),h=React.useRef(),{addComment:C,writing:g,handlePost:p,opId:R,opIdType:y}=l;l._LocalEventEmitter.unsubscribe(c),l._LocalEventEmitter.subscribe(c,e=>{e&&("click"===e.dispatch&&e?.e?e?.e?.target?.classList.contains("CommentForceNoBlur")||(i(!1),d?.current&&(d.current.style.minHeight="22px")):"comment_published"===e.dispatch?(d?.current&&(d.current.value=""),i(!1),l?.notifyNewComment&&l.notifyNewComment(e),o({message:e?.message??"Your comment was published",placement:"comment"}),h.current=setTimeout(()=>{o(null),l?.sub&&l?.handleCancelReply&&l.handleCancelReply(e)},3e4)):"error"===e.dispatch&&r({message:e?.message,placement:e?.placement}))}),React.useEffect(()=>{if(!e){const t=uuidv4();document.addEventListener("click",e=>{l?._LocalEventEmitter?.dispatch&&l._LocalEventEmitter.dispatch(t,{dispatch:"click",e:e})}),l?.defaultWriting&&b(null,!0),n(t),a(!0)}},[e]);const b=(e,t)=>{d?.current&&(d.current.style.minHeight="44px",t)&&l?.sub&&""===d?.current?.value&&l?.sub?.author_data?.username&&(d.current.value=`@${l.sub.author_data.username} `,d.current.focus(),t=d?.current?.value?.length,d.current.setSelectionRange(t,t)),i(!0)},v=React.useCallback(e=>{var t,a,n=d?.current;n&&(o(null),h?.current&&clearTimeout(h.current),n=n?.value,t=l?.COMMENT_THRESHOLD??3,n?.length>t?(r(null),a=l?.sub?.author,p(e,n,c,R,y,a)):r({message:`Your comment must be atleast ${t} characters long`,placement:"comment"}))});var S=React.useCallback(e=>{o(null),d?.current&&(d.current.value=""),l?.handleCancelReply&&l.handleCancelReply(e),i(!1)}),N=React.useCallback(e=>{r(null)}),E=React.useCallback(e=>{o(null)});return React.createElement("div",{className:l.className+" AddComment_Container"},C||g?React.createElement("div",{className:ChatStyles.commentInputContainer+" AddComment_ChatInputContainer CommentForceNoBlur"},!l?.sub||l.sub&&!s?React.createElement("img",{className:""+WatchPageStyles?.watchIcon,src:""+(l?._loggedIn?.icon??"img/default/greyIcon.png")}):null,React.createElement("div",{className:ChatStyles.chatInputSendContainer+" AddComment_ChatInputSendContainer CommentForceNoBlur"},!l?.sub||l.sub&&!s?React.createElement(TextareaAutosize,{className:`${ChatStyles.textCommentInput} ${ChatStyles.highlightBorder} Chat_TextChatInput CommentForceNoBlur`,ref:d,onKeyPress:e=>{handleKeyPressChat(e,v)},onChange:e=>{0<e?.currentTarget?.value?.length&&i(!0),o(null)},onFocus:b,disabled:m,placeholder:"Add a "+(l?.commentPlaceholder??"comment...")}):null,React.createElement("div",{className:"flex gap-p2 CommentForceNoBlur"},React.createElement("button",{className:`${ChatStyles.send} ${ChatStyles.highlightBorder} Chat_Send CommentForceNoBlur`,style:{display:u?"block":"none"},onClick:S,disabled:m},"Cancel"),React.createElement("button",{className:`${ChatStyles.send} ${ChatStyles.highlightBorder} Chat_Send CommentForceNoBlur`,style:{display:u?"block":"none"},onClick:v,disabled:m},"Comment")),t?React.createElement("div",{className:"error CommentForceNoBlur",style:{margin:".25rem",marginBottom:"0"},onClick:N},t.message):null,s?React.createElement("div",{className:"success CommentForceNoBlur",style:{margin:".25rem",marginBottom:"0"},onClick:E},s.message):null)):null)};export default Module;