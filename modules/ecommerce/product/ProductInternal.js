function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}import React from"react";import{resolveDefaultStyle,resolveRegionBasedPrice}from"../../utility/ecommerce";import{fireGlobalEvent}from"../../utility/utility";import PIMStyles from"./ProductImageManager.module.scss";import{Product}from"/layout/product";const Module=r=>{const[e,t]=React.useState(!1),[n,i]=React.useState({}),[o,c]=React.useState(null);var[u,a]=React.useState(null),s=React.useRef(),l=React.useRef();const d=React.useRef(),p=React.useRef(),[g,y]=React.useState(!1);var f=React.useRef();const m=React.useRef();React.useEffect(()=>{e||(r.setDefaultPriceHtml(),t(!0))},[e,t,r.product]),resolveDefaultStyle(r.product,n,i,o,c);var v=React.useCallback(t=>{var e;t&&t.currentTarget&&t.currentTarget.value&&(i(t.currentTarget.value),e=r.product.styles.find(e=>e.sid===t.currentTarget.value))&&e.option&&e.option[0]&&e.option[0].sid&&c(e.option[0].sid)}),R=React.useCallback(e=>{c(e.currentTarget.value??""),r.changeCurrentOption(e)}),b=React.useCallback(e=>{var t;console.log(e,"edit"),e&&e.currentTarget&&e.currentTarget.getAttribute&&e.currentTarget.getAttribute("modif")&&(t=e.currentTarget.getAttribute("modif"),e.currentTarget,"edit"===t)&&r.handleEdit&&(r.handleEdit(r.product),setTimeout(()=>{r.nameRef.current.value=r?.product?.name,r.product.styles&&r.product.styles[0]&&(r.styleInput.current.value=r.product.styles[0].style,r.setEditingSelectedStyle(r.product.styles[0].sid),setTimeout(()=>{console.log(r,r.product.styles[0].option&&r.product.styles[0].option[0]),r.product.styles[0].option&&r.product.styles[0].option[0]&&(r.optionInput.current&&(e=r.product.styles[0].option[0].option??"",console.log(e),r.optionInput.current.value=e),r.setEditingSelectedOption(r.product.styles[0].option[0].sid),r.quantityInput.current.value=r.product.styles[0].option[0].quantity,r.priceInput.current.value=r.product.styles[0].price,console.log(r.product.detailmeta),r.product.detailmeta&&(d.current&&(d.current.value=r.product.detailmeta.ticket),p.current)&&(p.current.value=r.product.detailmeta.livestream),r.setEditingOptionsMeta(r.product.detailmeta));var e=document.getElementById(r.product.id);e?.offsetTop&&window?.scrollTo&&r._isMobile&&window.scrollTo({behavior:"smooth",top:e.offsetTop-5})},250))},250))}),E=React.useCallback(async e=>{fireGlobalEvent(e,r._LocalEventEmitter)}),S=React.useCallback(e=>g?(y(!1),!1):(y(!0),!0)),C=React.useCallback(e=>{const t=r.changeCurrentCurrency(r.editing,e.currentTarget.value);t&&(m.current.innerHTML=t,e=Object.entries(r.regionsData).find(e=>e[1].currency===t))&&e[1]&&(r.setCurrentDefinePriceCurrency(e[1]),r.setDefaultPriceHtml(e[1]))}),T=React.useCallback(e=>{var t,e=e.currentTarget.value;r.editing&&(t={...r.editingOptionsMeta})&&r.setEditing&&(t.description=e,(e={...r.editing}).detailmeta=t,r.setEditing(e),t)&&r.setEditingOptionsMeta&&r.setEditingOptionsMeta(t)});const O=n&&r.product&&r.product.styles&&r.product.styles.find(e=>e.sid===n)?r.product.styles.find(e=>e.sid===n):null;var h=O&&O.option?o?O.option.find(e=>e.sid===o):O.option[0]||null:null,P=r.product&&r.product.owner&&r._loggedIn&&r._loggedIn.identifier&&r._loggedIn.identifier===r.product.owner,I=React.useMemo(()=>resolveRegionBasedPrice(r,O),[r.product,O,"$"]),M=r?.editing?.id&&r?.product?.id&&r.editing.id===r.product.id,k=M&&r?.editingOptionsMeta||!M&&r.product.detailmeta;return React.createElement("div",{className:`${M?PIMStyles.currentlyEditingProductContainer:"Product_col"} `+r.className,id:r.product&&r.product.id?r.product.id:"",selectedstyle:O?.sid?O.sid:"",currentoption:h?.sid?h.sid:""},React.createElement(Product,_extends({},r,{isEditing:M,useEditingOptions:k,validStyleObject:O,validOptionObject:h,isAdmin:P,handleEdit:b,currentPrice:I,handleFireGlobalEvent:E,selectedStyle:n,currentOption:o,handleUpdateProductDescription:T,descriptionInputRef:f,isSettingCurrency:g,handleSetIsSettingCurrency:S,currentCurrencyRef:m,isTicketRef:d,isLivestreamRef:p,warning:u,setWarning:a,setSelectedStyleHandler:v,changeCurrentOption:R,handleChangeCurrentCurrency:C,optionSelect:s,styleSelect:l})))};export default Module;