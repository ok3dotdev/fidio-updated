import React from"react";import Head from"next/head";import{useRouter}from"next/router";import resolveConfig from"/app.config";import{generateComponent,handlePropsPriority,resolvePage,resolveDefaults}from"/modules/utility.js";import{isObjectEmpty}from"/modules/util";import{constructGeneral,paintMeta}from"./meta/general";import middlewareFunctions from"/customModules/middleware/MiddlewareFunctions";import{SliderStyles,SliderTheme,GoogleFontsLink,PaystackScript}from"/modules/internal/localImports";import{UploadPage}from"/modules/video/upload";import{ArticlePage}from"/modules/article";import{submitNewPassword}from"/modules/utility/onboarding/Password";import{Admin}from"/modules/admin";const resolveSimulatedUrl=(e="",t="")=>{return new URL(e,"https://"+t)},PageContainer=t=>{const a=useRouter();var e=a["query"];const[l,r]=React.useState(!1),[n,o]=React.useState({}),[s,i]=React.useState(-1),[c,m]=React.useState(null);console.log("Render",t?.renderSchema,t.simulatedPage,t);var u=t?.simulating&&t?.simulatedPage&&t?.renderSchema?t.renderSchema?.content?.config?.platform?.pages?.find(e=>e.url===t.simulatedPage):null;console.log(u);const p=t?.simulating&&t.simulatedPage?t.simulatedPage:t.path;var d=resolveSimulatedUrl(t.simulatedUrl,t.domainUrl),g=new URLSearchParams(d.search);const f=t?.simulating?g:e,y=(t?.simulating?d:a)?.pathname;g=resolveConfig(t._configVariables,t);let h=resolvePage(g,p);(t?.simulating&&u?u:h)?.data;e="/a"===h?.url||"/a"===y;const R=React.useRef(),v=async e=>{var e=await resolveDefaults(h.url,t,t._configVariables,f,p,r,e,y);isObjectEmpty(e)||(e=Object.assign({...t},e),o(e))};t._LocalEventEmitter.unsubscribe("refetchDefaults"),t._LocalEventEmitter.subscribe("refetchDefaults",e=>{v(!0)}),React.useEffect(()=>{h&&h.url&&!l&&isObjectEmpty(n)&&v()},[l,n,h]),console.log(n,t,t?.renderSchema);var d=handlePropsPriority(n,t),g=resolveConfig(t._configVariables,d),u=(h=resolvePage(g,t?.simulating?p:d.path),g=(t?.simulating&&u?u:h)?.data,console.log(g,h),generateComponent(g)),E=!g||g?.props&&!Object.prototype.hasOwnProperty.call(g.props,"useMenu")||g.props?.useMenu,C=!g||g?.props&&!Object.prototype.hasOwnProperty.call(g.props,"useAppConfigLayout")||g.props?.useAppConfigLayout;const P=Object.assign({},d);P.useMenu=E,P.useAppConfigLayout=C;E=React.createElement("div",{className:d.pageName+"_Body "+(t.pageClass??""),style:{top:d.menuConfig.height?d.menuConfig.height+"px":"",position:"relative"}},u);P.useAppConfigLayout&&(P.appConfigLayout=E);const w=(e,l=0,r)=>{let n=0;return React.Children.map(e,function(t){if(null===t||"function"!=typeof t.type)return n++,React.createElement("div");{0<l&&delete P.children;let e=P;var a=r&&r[n]?r[n]:null;return(e=a?.props?Object.assign(a.props,e):e)?.children&&(e.children=w(e.children,l+1,a?.children??null)),n++,React.cloneElement(t,e)}})};var u=w(t.children,0,g?.children??null),E="/upload"===h?.url||"/upload"===y,g="/reset"===h?.url||"/reset"===y,b="/admin"===h?.url||"/admin"===y;let S=constructGeneral(a,P);middlewareFunctions?.transformMeta&&(S=middlewareFunctions.transformMeta(a,S,P));var _=React.useCallback(async e=>{var t;a?.query&&"password"===a.query.reset&&a.query.token&&a.query.email&&(-1===s||s<(new Date).getTime()-600)&&0<R?.current?.value?.length&&(t=await submitNewPassword(R.current.value,a.query.token,a.query.email,a.query.goto))?.data&&m({data:t.data,status:t.message,goto:a.query.goto??""}),i((new Date).getTime())});return console.log(u),React.createElement(React.Fragment,null,React.createElement(Head,null,React.createElement("title",null,P.siteTitle),P?.googleClientId?React.createElement("meta",{name:"google-signin-client_id",content:""+P.googleClientId}):null,paintMeta(S),SliderStyles,SliderTheme,GoogleFontsLink,PaystackScript,React.createElement("link",{rel:"icon",href:"/favicon.ico"})),React.createElement("div",{className:e?"Article_SafeStyles":""},u,!h?.data&&E&&C?React.createElement("div",{className:d.pageName+"_Body "+(t.pageClass??""),style:{top:d.menuConfig.height?d.menuConfig.height+"px":"",position:"relative"}},React.createElement(UploadPage,P)):null,!h?.data&&e&&C?React.createElement("div",{className:d.pageName+"_Body "+(t.pageClass??""),style:{top:d.menuConfig.height?d.menuConfig.height+"px":"",position:"relative"}},React.createElement(ArticlePage,P)):null,!h?.data&&b&&C?React.createElement("div",{className:d.pageName+"_Body "+(t.pageClass??"")},React.createElement(Admin,P)):null,!h?.data&&g&&C?React.createElement("div",{className:d.pageName+"_Body "+(t.pageClass??""),style:{top:d.menuConfig.height?d.menuConfig.height+"px":"",position:"relative"}},React.createElement("div",{style:{margin:"0 auto",textAlign:"center"}},React.createElement("h3",null,"Reset Password"),React.createElement("h4",null,a?.query?.email),c?.goto?React.createElement("div",null,React.createElement("p",null,React.createElement("a",{href:`https://${t?.domainUrl}/`+c.goto,className:"reset_password_link",style:{color:"#ff6deb"}},c?.message??"Successfully reset password. Please sign in"))):React.createElement("div",null,React.createElement("div",{style:{display:"flex",gap:".5rem",justifyContent:"center"}},React.createElement("label",null,"Password"),React.createElement("input",{type:"password",id:"reset_password_secure",ref:R})),React.createElement("button",{style:{marginTop:"1rem"},onClick:_},"Submit")))):null))};export default PageContainer;