import React from"react";import Head from"next/head";import{useRouter}from"next/router";import resolveConfig from"/app.config";import{generateComponent,handlePropsPriority,resolvePage,resolveDefaults}from"/modules/utility.js";import{isObjectEmpty}from"/modules/util";import{constructGeneral,paintMeta}from"./meta/general";import middlewareFunctions from"/customModules/middleware/MiddlewareFunctions";import{SliderStyles,SliderTheme,GoogleFontsLink,PaystackScript}from"/modules/internal/localImports";import{UploadPage}from"/modules/video/upload";import{ArticlePage}from"/modules/article";import{submitNewPassword}from"/modules/utility/onboarding/Password";const PageContainer=t=>{const a=useRouter(),{query:o,asPath:r}=a,[e,l]=React.useState(!1),[n,s]=React.useState({}),[i,c]=React.useState(-1),[m,u]=React.useState(null);t.resolvedDefinition;let p=resolvePage(resolveConfig(t._configVariables,t),t.path);p&&p.data;var g="/a"===p?.url||"/a"===a.pathname;const d=React.useRef(),f=async e=>{var e=await resolveDefaults(p.url,t,t._configVariables,o,r,l,e,a?.pathname);isObjectEmpty(e)||(e=Object.assign({...t},e),s(e))};t._LocalEventEmitter.unsubscribe("refetchDefaults"),t._LocalEventEmitter.subscribe("refetchDefaults",e=>{f(!0)}),React.useEffect(()=>{p&&p.url&&!e&&isObjectEmpty(n)&&f()},[e,n,p]);var y=handlePropsPriority(n,t),h=(v=(p=resolvePage(resolveConfig(t._configVariables,y),y.path))&&p.data,generateComponent(v)),R=!v||v?.props&&!Object.prototype.hasOwnProperty.call(v.props,"useMenu")||v.props?.useMenu,v=!v||v?.props&&!Object.prototype.hasOwnProperty.call(v.props,"useAppConfigLayout")||v.props?.useAppConfigLayout;const E=Object.assign({},y);E.useMenu=R,E.useAppConfigLayout=v;var R=React.createElement("div",{className:y.pageName+"_Body "+(t.pageClass??""),style:{top:y.menuConfig.height?y.menuConfig.height+"px":"",position:"relative"}},h),h=(E.useAppConfigLayout&&(E.appConfigLayout=R),React.Children.map(t.children,function(e){return null!==e&&"function"==typeof e.type?React.cloneElement(e,E):React.createElement("div")})),R="/upload"===p?.url||"/upload"===a.pathname,C="/reset"===p?.url||"/reset"===a.pathname;let P=constructGeneral(a,E);middlewareFunctions?.transformMeta&&(P=middlewareFunctions.transformMeta(a,P,E));var w=React.useCallback(async e=>{var t;a?.query&&"password"===a.query.reset&&a.query.token&&a.query.email&&(-1===i||i<(new Date).getTime()-600)&&0<d?.current?.value?.length&&(t=await submitNewPassword(d.current.value,a.query.token,a.query.email,a.query.goto))?.data&&u({data:t.data,status:t.message,goto:a.query.goto??""}),c((new Date).getTime())});return console.log("Article Page",g,"Upload Page",R,p,m),React.createElement(React.Fragment,null,React.createElement(Head,null,React.createElement("title",null,E.siteTitle),E?.googleClientId?React.createElement("meta",{name:"google-signin-client_id",content:""+E.googleClientId}):null,paintMeta(P),SliderStyles,SliderTheme,GoogleFontsLink,PaystackScript,React.createElement("link",{rel:"icon",href:"/favicon.ico"})),React.createElement("div",{className:g?"Article_SafeStyles":""},h,!p?.data&&R&&v?React.createElement("div",{className:y.pageName+"_Body "+(t.pageClass??""),style:{top:y.menuConfig.height?y.menuConfig.height+"px":"",position:"relative"}},React.createElement(UploadPage,E)):null,!p?.data&&g&&v?React.createElement("div",{className:y.pageName+"_Body "+(t.pageClass??""),style:{top:y.menuConfig.height?y.menuConfig.height+"px":"",position:"relative"}},React.createElement(ArticlePage,E)):null,!p?.data&&C&&v?React.createElement("div",{className:y.pageName+"_Body "+(t.pageClass??""),style:{top:y.menuConfig.height?y.menuConfig.height+"px":"",position:"relative"}},React.createElement("div",{style:{margin:"0 auto",textAlign:"center"}},React.createElement("h3",null,"Reset Password"),React.createElement("h4",null,a?.query?.email),m?.goto?React.createElement("div",null,React.createElement("p",null,React.createElement("a",{href:`https://${t?.domainUrl}/`+m.goto,className:"reset_password_link",style:{color:"#ff6deb"}},m?.message??"Successfully reset password. Please sign in"))):React.createElement("div",null,React.createElement("div",{style:{display:"flex",gap:".5rem",justifyContent:"center"}},React.createElement("label",null,"Password"),React.createElement("input",{type:"password",id:"reset_password_secure",ref:d})),React.createElement("button",{style:{marginTop:"1rem"},onClick:w},"Submit")))):null))};export default PageContainer;