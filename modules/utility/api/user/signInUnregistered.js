import{fetchPost}from"/modules/utility/fetch";import{resolveVariables}from"../../../../app.config";import{updateCart}from"/modules/utility/ecommerce/ecommerce.js";import{_LocalEventEmitter}from"/modules/events/LocalEventEmitter";import{checkSignedIn,updateLocalLoginSession}from"/modules/utility/onboarding/SignIn";import{setStripeSecretData}from"../../payment";export default async function handler(e){if(!e||checkSignedIn())return!1;var t=e.props;t.setFetchBusy(!0);try{var a={email:e.email,firstName:e.firstName,lastName:e.lastName,unregistered:!0},r=await fetchPost(resolveVariables()?.apiUrl+"/m/authenticate",null,null,a);if(!r.status||r.status&&401!==r.status){t.setFetchBusy(!1),_LocalEventEmitter&&_LocalEventEmitter.dispatch("completeSignIn",{data:r});var i={identifier:r.identifier,username:r.username,email:r.email,icon:r.icon,hash:r.hash,vendor:r.vendor??null,icon:r.icon,meta:r.meta},n=(r.plan&&(i.plan=r.plan),i.admin=null,updateLocalLoginSession(i),new CustomEvent("mute-login-error",{detail:!0}));document.dispatchEvent(n);let e;return t&&(e=await setStripeSecretData(t.apiUrl,t.domainKey,i,t._setStripeSecret),t._setLoggedIn(i)),{user:i,stripeSecret:e,stripeSecret:e}}return t.setFetchBusy(!1),!1}catch(e){return t.setFetchBusy(!1),!1}}