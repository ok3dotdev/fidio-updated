import{fetchPost}from"/modules/utility/fetch/fetch.js";import{logout}from"/modules/utility/onboarding/SignIn.js";const beginStream=async(t,e,i,s)=>{s=s();if(s&&s.identifier&&s.hash){e={cus_id:i.stripeSecret.user,dontForce:i.dontForce,streamSettings:i.streamSettings,domainKey:e,hash:s.hash,identifier:s.identifier,streamingFor:i?.streamingFor},s=await fetchPost(t+"/m/beginstream",null,null,e);if(s&&s.hasOwnProperty("status")){if("disauthenticated"==s.status)return logout(),"disauthenticated";if("failed"==s.status)return!1;if("success"==s.status)return s}}return!1},endStream=async(t,e,i,s)=>{s=s();if(s&&s.identifier&&s.hash){i={stream:i.stream,domainKey:e,hash:s.hash,identifier:s.identifier},e=await fetchPost(t+"/m/endstream",null,null,i);if(e&&e.hasOwnProperty("status")){if("disauthenticated"==e.status)return logout(),"disauthenticated";if("failed"==e.status)return!1;if("success"==e.status)return e}}return!1},doFetchAuthForStream=async(t,e,i,s)=>{s=s();if(s&&s.identifier&&s.hash){i={stream:i,domainKey:e,hash:s.hash,identifier:s.identifier},e=await fetchPost(t+"/m/getauthforstream",null,null,i);if(e&&e.hasOwnProperty("status")){if("disauthenticated"==e.status)return logout(),"disauthenticated";if("failed"==e.status)return!1;if("success"==e.status)return e}}return!1},updateStreamConfigRequest=async(t,e,i,s)=>{s=s();if(s&&s.identifier&&s.hash){i={stream:i.stream,streamData:i.streamData,streamSettings:i.streamSettings,domainKey:e,hash:s.hash,identifier:s.identifier},e=(console.log(i),await fetchPost(t+"/m/updatestreamconfig",null,null,i));if(e&&e.hasOwnProperty("status")){if("disauthenticated"==e.status)return logout(),"disauthenticated";if("failed"==e.status)return!1;if("success"==e.status)return e}}return!1},requestStreamingPermissions=async(t,e,i)=>{i=i();if(i&&i.identifier&&i.hash){e={domainKey:e,hash:i.hash,identifier:i.identifier},i=(console.log(e),await fetchPost(t+"/m/requeststreamingpermissions",null,null,e));if(i&&i.hasOwnProperty("status")){if("disauthenticated"==i.status)return logout(),"disauthenticated";if("failed"==i.status)return!1;if("success"==i.status)return i}}return!1},checkAuthorization=(t,e,i,s)=>{if(t?.meta?.streamSettings){var r=t.meta.streamSettings;if(console.log("Settings",r,e,t,i?._loggedIn?.identifier,t.author),r?.private)return(i?._loggedIn?.identifier&&t?.author&&t.author==i._loggedIn.identifier||!!e?.allowed)&&(s&&s(),!0)}return s&&s(),!0},checkPlayerIsPlaying=t=>{try{return 0<t?.current?.currentTime()&&!1===t?.current?.paused()&&!1===t?.current?.ended()&&2<t?.current?.readyState()?!0:!1}catch(t){return console.log(t),!1}};export{beginStream,endStream,doFetchAuthForStream,updateStreamConfigRequest,requestStreamingPermissions,checkAuthorization,checkPlayerIsPlaying};