function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a,l=arguments[t];for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e}).apply(this,arguments)}import React from"react";import Link from"next/link";import{v4 as uuidv4}from"uuid";import Tooltip from"@mui/material/Tooltip";import AdminStyles from"./Admin.module.scss";import{logout}from"../utility/onboarding/SignIn";import{fetchPost}from"../utility/fetch";import{MONTHS}from"../utility/utility/date";import{westernMoneyFormat}from"../utility/ecommerce";import{throttleFunctionCall}from"../util";import{CreditCard}from"../payment";const moduleName="BillingAdmin",Module=m=>{const[t,a]=React.useState(!1),[,l]=React.useState(null),[r,c]=React.useState(!1),[s,n]=React.useState((new Date).getMonth()),[o,i]=React.useState((new Date).getFullYear()),[d,u]=React.useState(null),[e,y]=React.useState(null),[p,R]=React.useState([]),[E,v]=React.useState(!1),[f,g]=React.useState(null),h=(m._LocalEventEmitter.unsubscribe(moduleName),m._LocalEventEmitter.subscribe(moduleName,e=>{e&&e.dispatch}),React.useEffect(()=>{var e;t||(e=uuidv4(),l(e),h(),a(!0))},[t]),async(e,t)=>{var a,l,n,i;try{if(!r)return c(!0),a=setTimeout(()=>{c(!1)},1e4),l={domainKey:m.domainKey,hash:m._loggedIn.hash,identifier:m._loggedIn.identifier,month:void 0!==e?e:s,year:void 0!==t?t:o,adminStripeSecretKey:!0},(n=await fetchPost(m.apiUrl+"/a/getplatformbillinginvoices",null,null,l))?n.hasOwnProperty("status")?(c(!1),clearTimeout(a),"disauthenticated"==n.status?(logout(),"disauthenticated"):"failed"==n.status?(u(null),!1):"success"==n.status?(console.log(n),n?.data&&u(n.data),n?.adminStripeSecretKey&&(g(n.adminStripeSecretKey),v(!0)),n.outstanding&&y(n.outstanding),n?.payments&&n.payments?.nestedResults&&(i=n.payments.nestedResults,R(i)),n):void 0):void 0:(c(!1),clearTimeout(a),!1)}catch(e){c(!1)}}),b=React.useCallback(async e=>{var t;e?.currentTarget?.getAttribute&&(t=e.currentTarget.getAttribute("m"),e=e.currentTarget.getAttribute("y"),void 0!==t)&&void 0!==e&&(n(Number(t)),i(Number(e)),await h(Number(t),Number(e)))});var N=React.useMemo(()=>{var t=[];let a=(new Date).getMonth(),l=(new Date).getFullYear();for(let e=0;e<24;e++)t.push({m:a,y:l}),0===a?(--l,a=11):--a;return t},[s,o]);return console.log(s,o,d,m),React.createElement("div",{className:`${m.className} ${moduleName}_Container`},React.createElement("h3",null,"Billing"),React.createElement("div",{className:"Billing_Container"},React.createElement("div",{className:AdminStyles.MonthsContainer+" tagContainer tinyBar",style:{paddingBottom:".25rem"}},N.map((e,t)=>React.createElement("button",{className:"tagItem "+(s===e.m&&o===e.y?"tagItemSelected":""),style:{whiteSpace:"nowrap"},key:t,m:e.m,y:e.y,onClick:b},MONTHS[e.m]," ",e.y))),E?React.createElement("div",{style:{marginBottom:".5rem"}},React.createElement(CreditCard,_extends({},m,{useAdmin:f,hide:E}))):null,0<p?.length?React.createElement("div",null,React.createElement("div",{style:{fontSize:"1rem",fontWeight:"600"}},"Payments"),React.createElement("div",{style:{maxHeight:"150px",overflow:"auto"}},React.createElement("table",{className:AdminStyles.DetailTable+" "+AdminStyles.DetailTableCheckered,style:{width:"100%"}},React.createElement("tr",null,React.createElement("th",null,"Total"),React.createElement("th",null,"Status"),React.createElement("th",null,"Date"),React.createElement("th",null,"id")),p.map((e,t)=>React.createElement(React.Fragment,null,e?.meta?.status?React.createElement("tr",{key:t},React.createElement("td",{style:{fontWeight:600,color:-1<["succeeded"].indexOf(e.meta.status)?"#a6e22e":""}},"$ ",e?.completetotal?westernMoneyFormat.format(e.completetotal):""," ",e?.meta?.currency?e.meta.currency.toUpperCase():""),React.createElement("td",null,"succeeded"===e.meta.status?"Paid":e.meta.status),React.createElement("td",null,e?.meta?.created&&!isNaN(new Date(e.meta.created))?new Date(e.meta.created).toString():""),React.createElement("td",null,e?.id??"")):null))))):null,e?React.createElement("div",{style:{marginBottom:".5rem"}},React.createElement("div",{style:{fontSize:"1rem",fontWeight:"600"}},"Currently Outstanding"),React.createElement("div",null,"$ ",e.total?westernMoneyFormat.format(e.total):"0")):null,r?React.createElement("div",{className:"Ecommerce_Spinner Ecommerce_SpinnerVisible",style:{height:"25px",width:"50px",position:"relative"}},React.createElement("div",{className:"spinner spinnerSm opacity1",style:{margin:0}})):0===d?.simpleData?.total&&"not due"!==d?.status?React.createElement("div",{style:{marginBottom:".5rem"}},React.createElement("div",{style:{fontSize:"1rem",fontWeight:"600"}},"No bill this month"),React.createElement("div",null,"Thankyou for your Business")):"paid"===d?.status?React.createElement("div",{style:{marginBottom:".5rem"}},React.createElement("div",{style:{fontSize:"1rem",fontWeight:"600"}},"Paid"),React.createElement("div",null,"Thankyou for your Business")):null,React.createElement("div",null,r?null:d?React.createElement("div",{className:""+AdminStyles.ChargesExternalContainer,style:{marginTop:".5rem"}},React.createElement("div",{style:{fontWeight:"600",fontSize:"1.5rem",marginBottom:"2rem",marginTop:"1rem"}},"Tycoon Systems Corp. charges by service"),React.createElement("div",{className:""+AdminStyles.ChargesContainer,style:{marginBottom:"2rem"}},React.createElement("div",{className:""+AdminStyles.ChargesInternalContainer},React.createElement("div",{className:""+AdminStyles.DetailTableContainer},React.createElement("table",{className:AdminStyles.DetailTable+" "+AdminStyles.DetailTableCheckered,style:{width:"100%"}},React.createElement("tr",null,React.createElement("th",null,"Details"),React.createElement("th",null,"Rate"),React.createElement("th",null,"Qty"),React.createElement("th",null,"Line Total")),d?.simpleData?.table?d.simpleData.table.map((e,t)=>React.createElement("tr",{key:t},React.createElement("td",{className:""+AdminStyles.DescriptionContainer},e.description,e.customerCharged?React.createElement(React.Fragment,null,React.createElement("span",null," | "),React.createElement("span",null,React.createElement("span",{style:{color:"#27ff27",fontWeight:"600"}},"$",westernMoneyFormat.format(e.customerCharged))," USD was processed this period ",-1<["due","sent"].indexOf(d?.status)?"":"so far")):null),React.createElement("td",{className:""+AdminStyles.TableNumber},e.rate,"/",e.measureBy),React.createElement("td",{className:""+AdminStyles.TableNumber},e.qty.toFixed?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.qty):e.qty),React.createElement("td",{className:""+AdminStyles.TableNumber},e.lineTotal.toFixed?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.lineTotal):e.lineTotal))):null)),React.createElement("div",{className:"flex gap-p20",style:{justifyContent:"right",marginTop:"1rem"}},React.createElement("div",{style:{maxWidth:"300px",width:"100%"}},React.createElement("div",{className:"flex",style:{justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Subtotal"),React.createElement("div",{className:"w600"},"$ ",d?.simpleData?.subTotal?westernMoneyFormat.format(d.simpleData.subTotal):"0")),React.createElement("div",{className:"flex",style:{justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Tax"),React.createElement("div",{className:"w600"},"$ ",d?.simpleData?.subTotal?westernMoneyFormat.format(d.simpleData.tax):"0")),React.createElement("div",null," "),React.createElement("div",{className:"flex",style:{borderTop:"1px solid black",justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Current Bill Total"),React.createElement("div",{className:"w600"},"$ ",d?.simpleData?.total?westernMoneyFormat.format(d.simpleData.total):"0")),React.createElement("div",{style:{fontSize:".7rem"}},"(",d?.simpleData?.currency??" ",")"))),React.createElement("div",null,React.createElement("div",{style:{marginTop:"1rem"}},"not due"===d?.status?"This Bill is not due yet":-1<["due","sent"].indexOf(d?.status)?"This Bill is due, please see Invoice":0===d?.simpleData?.total?"No Bill this month":-1<["paid"].indexOf(d?.status)?"This Bill has been paid":" "))))):React.createElement("div",null,"No Billing Info for this period"),!r&&-1<["due","sent","paid"].indexOf(d?.status)&&void 0!==s&&null!==d&&0!==d?.simpleData?.total?React.createElement("div",null,React.createElement("div",{style:{fontWeight:"600",fontSize:"1.5rem",marginBottom:"2rem",marginTop:"1rem"}},"Please see your Invoice for the month of ",d?.simpleData?.period??""+MONTHS[s]+o??" "," below"),React.createElement("div",{className:""+AdminStyles.InvoiceContainer,style:{marginBottom:"2rem",position:"relative"}},React.createElement("div",{className:""+AdminStyles.InvoiceInternalContainer},-1<["paid"].indexOf(d?.status)?React.createElement("div",{className:""+AdminStyles.PaidStamp},"Paid"):null,React.createElement("div",null,React.createElement("div",{className:""+AdminStyles.Entity,style:{marginBottom:".5rem"}},d?.data?.payeeEntity??" "),React.createElement("div",null,d?.data?.address??" "),React.createElement("div",{className:"flex gap-p2"},React.createElement("div",null,d?.data?.payeeCity?d.data.payeeCity+", ":" "),React.createElement("div",null,d?.data?.payeeState??" "),React.createElement("div",null,d?.data?.payeePostalCode??" ")),React.createElement("div",null,d?.data?.payeeCountry??" "),React.createElement("div",{className:"flex gap-p2"},React.createElement("div",null,d?.data?.payeeNumber??" "),React.createElement("div",null,d?.data?.payeeNumber&&d?.data?.payeeWebsite?"|":" "),React.createElement("div",null,d?.data?.payeeWebsite??" "))),React.createElement("div",{className:""+AdminStyles.QuoteContainer},React.createElement("div",{className:""+AdminStyles.InvoiceLabel},"INVOICE"),React.createElement("div",null,React.createElement("div",{className:"flex",style:{justifyContent:"space-between",marginLeft:"25%"}},React.createElement("div",null,"Invoice #"),React.createElement("div",null,d?.id??" ")),React.createElement("div",{className:"flex",style:{justifyContent:"space-between",marginLeft:"25%"}},React.createElement("div",null,"Date"),React.createElement("div",null,d?.simpleData?.dateIssued?new Date(d.simpleData.dateIssued).toLocaleDateString()+" "+new Date(d.simpleData.dateIssued).toTimeString():" ")))),React.createElement("div",{className:"flex gap-p2",style:{justifyContent:"space-between"}},React.createElement("div",null,React.createElement("div",{style:{fontWeight:"600"}},"Bill To"),React.createElement("div",null,d?.data?.payerEntity?d.data.payerEntity.toUpperCase():""),React.createElement("div",{className:"flex gap-p2"},React.createElement("div",null,d?.data?.payerCity?d.data.payerCity+", ":""),React.createElement("div",null,d?.data?.payerState??""),React.createElement("div",null,d?.data?.payerPostalCode??"")),React.createElement("div",null,d?.data?.payerCountry??""),React.createElement("div",{className:"flex gap-p2"},d?.data?.payerNumber?React.createElement("div",null,d?.data?.payerNumber):null,d?.data?.payerNumber&&d?.data?.payerWebsite?React.createElement("div",null,d?.data?.payerNumber&&d?.data?.payerWebsite?"|":""):null,React.createElement("div",null,d?.data?.payerWebsite??" "))),d?.simpleData?.total&&d?.data?.currency?React.createElement("div",null,React.createElement("div",{style:{marginBottom:".25rem"}},"TOTAL AMOUNT DUE IN ",d.data.currency),React.createElement("div",{style:{fontSize:"2rem",textAlign:"right",fontWeight:"600",background:"blue",color:"white"}},"$ ",westernMoneyFormat.format(d.simpleData.total))):null),React.createElement("div",{className:""+AdminStyles.DetailTableContainer},React.createElement("table",{className:""+AdminStyles.DetailTable},React.createElement("tr",null,React.createElement("th",null,"Details"),React.createElement("th",null,"Rate"),React.createElement("th",null,"Qty"),React.createElement("th",null,"Line Total")),d?.simpleData?.table?d.simpleData.table.map((e,t)=>React.createElement("tr",{key:t},React.createElement("td",{className:""+AdminStyles.DescriptionContainer},e.description," ",e.customerCharged?`| $${westernMoneyFormat.format(e.customerCharged)} USD was processed this period`:""),React.createElement("td",{className:""+AdminStyles.TableNumber},e.rate,"/",e.measureBy),React.createElement("td",{className:""+AdminStyles.TableNumber},e.qty.toFixed?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.qty):e.qty),React.createElement("td",{className:""+AdminStyles.TableNumber},e.lineTotal.toFixed?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.lineTotal):e.lineTotal))):null)),React.createElement("div",{className:"flex gap-p20",style:{justifyContent:"space-between",marginTop:"1rem"}},React.createElement("div",{style:{width:"100%"}},React.createElement("div",{className:"w600",style:{fontSize:".8rem"}},"Payment Method"),React.createElement("div",{style:{fontSize:".75rem"}},d?.data?.paymentMethod??" "),React.createElement("div",{style:{fontSize:".75rem",marginTop:"1rem"}},d?.data?.payeeNote??" ")),React.createElement("div",{style:{width:"100%"}},React.createElement("div",{className:"flex",style:{justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Subtotal"),React.createElement("div",{className:"w600"},"$ ",d?.simpleData?.subTotal?westernMoneyFormat.format(d.simpleData.subTotal):" ")),React.createElement("div",{className:"flex",style:{justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Tax"),React.createElement("div",{className:"w600"},"$ ",d?.simpleData?.subTotal?westernMoneyFormat.format(d.simpleData.tax):" ")),React.createElement("div",null," "),React.createElement("div",{className:"flex",style:{borderTop:"1px solid black",justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Total Due"),React.createElement("div",{className:"w600"},"$ ",d?.simpleData?.total?westernMoneyFormat.format(d.simpleData.total):" ")),React.createElement("div",{style:{fontSize:".7rem"}},"(",d?.simpleData?.currency??" ",")"))),React.createElement("div",null,React.createElement("div",{className:""+AdminStyles.millerText,style:{textAlign:"right",fontStyle:"italic"}},d?.data?.paymentThankyou??" "))))):null)))};export default Module;