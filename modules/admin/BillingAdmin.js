function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a,l=arguments[t];for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e}).apply(this,arguments)}import React from"react";import Link from"next/link";import{v4 as uuidv4}from"uuid";import Tooltip from"@mui/material/Tooltip";import AdminStyles from"./Admin.module.scss";import{logout}from"../utility/onboarding/SignIn";import{fetchPost}from"../utility/fetch";import{MONTHS}from"../utility/utility/date";import{westernMoneyFormat}from"../utility/ecommerce";import{throttleFunctionCall}from"../util";import{CreditCard}from"../payment";const moduleName="BillingAdmin",Module=a=>{const[t,l]=React.useState(!1),[,n]=React.useState(null),[i,m]=React.useState((new Date).getMonth()),[r,c]=React.useState((new Date).getFullYear()),[s,o]=React.useState(null),[e,d]=React.useState(null),[u,y]=React.useState(!1),[p,R]=React.useState(null),E=(a._LocalEventEmitter.unsubscribe(moduleName),a._LocalEventEmitter.subscribe(moduleName,e=>{e&&e.dispatch}),React.useEffect(()=>{var e;t||(e=uuidv4(),n(e),E(),l(!0))},[t]),async(e,t)=>{e={domainKey:a.domainKey,hash:a._loggedIn.hash,identifier:a._loggedIn.identifier,month:void 0!==e?e:i,year:void 0!==t?t:r,adminStripeSecretKey:!0},t=await fetchPost(a.apiUrl+"/a/getplatformbillinginvoices",null,null,e);return!!t&&(t.hasOwnProperty("status")?"disauthenticated"==t.status?(logout(),"disauthenticated"):"failed"==t.status?(o(null),!1):"success"==t.status?(console.log(t),t?.data&&o(t.data),t?.adminStripeSecretKey&&(R(t.adminStripeSecretKey),y(!0)),t.outstanding&&d(t.outstanding),t):void 0:void 0)}),v=React.useCallback(async e=>{var t;e?.currentTarget?.getAttribute&&(t=e.currentTarget.getAttribute("m"),e=e.currentTarget.getAttribute("y"),void 0!==t)&&void 0!==e&&(m(Number(t)),c(Number(e)),await E(Number(t),Number(e)))});var f=React.useMemo(()=>{var t=[];let a=(new Date).getMonth(),l=(new Date).getFullYear();for(let e=0;e<24;e++)t.push({m:a,y:l}),0===a?(--l,a=11):--a;return t},[i,r]);return console.log(i,r,s,a),React.createElement("div",{className:`${a.className} ${moduleName}_Container`},React.createElement("h3",null,"Billing"),React.createElement("div",{className:"Billing_Container"},React.createElement("div",{className:AdminStyles.MonthsContainer+" tagContainer tinyBar",style:{paddingBottom:".25rem"}},f.map((e,t)=>React.createElement("button",{className:"tagItem "+(i===e.m&&r===e.y?"tagItemSelected":""),style:{whiteSpace:"nowrap"},key:t,m:e.m,y:e.y,onClick:v},MONTHS[e.m]," ",e.y))),u?React.createElement("div",{style:{marginBottom:".5rem"}},React.createElement(CreditCard,_extends({},a,{useAdmin:p,hide:u}))):null,e?React.createElement("div",{style:{marginBottom:".5rem"}},React.createElement("div",{style:{fontSize:"1rem",fontWeight:"600"}},"Currently Outstanding"),React.createElement("div",null,"$ ",e.total?westernMoneyFormat.format(e.total):"0")):null,0===s?.simpleData?.total&&"not due"!==s?.status?React.createElement("div",{style:{marginBottom:".5rem"}},React.createElement("div",{style:{fontSize:"1rem",fontWeight:"600"}},"No bill this month"),React.createElement("div",null,"Thankyou for your Business")):"paid"===s?.status?React.createElement("div",{style:{marginBottom:".5rem"}},React.createElement("div",{style:{fontSize:"1rem",fontWeight:"600"}},"Paid"),React.createElement("div",null,"Thankyou for your Business")):null,React.createElement("div",null,s?React.createElement("div",{className:""+AdminStyles.ChargesExternalContainer,style:{marginTop:".5rem"}},React.createElement("div",{style:{fontWeight:"600",fontSize:"1.5rem",marginBottom:"2rem",marginTop:"1rem"}},"Tycoon Systems Corp. charges by service"),React.createElement("div",{className:""+AdminStyles.ChargesContainer,style:{marginBottom:"2rem"}},React.createElement("div",{className:""+AdminStyles.ChargesInternalContainer},React.createElement("div",{className:""+AdminStyles.DetailTableContainer},React.createElement("table",{className:AdminStyles.DetailTable+" "+AdminStyles.DetailTableCheckered,style:{width:"100%"}},React.createElement("tr",null,React.createElement("th",null,"Details"),React.createElement("th",null,"Rate"),React.createElement("th",null,"Qty"),React.createElement("th",null,"Line Total")),s?.simpleData?.table?s.simpleData.table.map((e,t)=>React.createElement("tr",{key:t},React.createElement("td",{className:""+AdminStyles.DescriptionContainer},e.description,e.customerCharged?React.createElement(React.Fragment,null,React.createElement("span",null," | "),React.createElement("span",null,React.createElement("span",{style:{color:"#27ff27",fontWeight:"600"}},"$",westernMoneyFormat.format(e.customerCharged))," USD was processed this period ",-1<["due","sent"].indexOf(s?.status)?"":"so far")):null),React.createElement("td",{className:""+AdminStyles.TableNumber},e.rate,"/",e.measureBy),React.createElement("td",{className:""+AdminStyles.TableNumber},e.qty.toFixed?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.qty):e.qty),React.createElement("td",{className:""+AdminStyles.TableNumber},e.lineTotal.toFixed?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.lineTotal):e.lineTotal))):null)),React.createElement("div",{className:"flex gap-p20",style:{justifyContent:"right",marginTop:"1rem"}},React.createElement("div",{style:{maxWidth:"300px",width:"100%"}},React.createElement("div",{className:"flex",style:{justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Subtotal"),React.createElement("div",{className:"w600"},"$ ",s?.simpleData?.subTotal?westernMoneyFormat.format(s.simpleData.subTotal):"0")),React.createElement("div",{className:"flex",style:{justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Tax"),React.createElement("div",{className:"w600"},"$ ",s?.simpleData?.subTotal?westernMoneyFormat.format(s.simpleData.tax):"0")),React.createElement("div",null," "),React.createElement("div",{className:"flex",style:{borderTop:"1px solid black",justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Current Bill Total"),React.createElement("div",{className:"w600"},"$ ",s?.simpleData?.total?westernMoneyFormat.format(s.simpleData.total):"0")),React.createElement("div",{style:{fontSize:".7rem"}},"(",s?.simpleData?.currency??" ",")"))),React.createElement("div",null,React.createElement("div",{style:{marginTop:"1rem"}},"not due"===s?.status?"This Bill is not due yet":-1<["due","sent"].indexOf(s?.status)?"This Bill is due, please see Invoice":0===s?.simpleData?.total?"No Bill this month":-1<["paid"].indexOf(s?.status)?"This Bill has been paid":" "))))):React.createElement("div",null,"No Billing Info for this period"),-1<["due","sent","paid"].indexOf(s?.status)&&void 0!==i&&null!==s&&0!==s?.simpleData?.total?React.createElement("div",null,React.createElement("div",{style:{fontWeight:"600",fontSize:"1.5rem",marginBottom:"2rem",marginTop:"1rem"}},"Please see your Invoice for the month of ",s?.simpleData?.period??""+MONTHS[i]+r??" "," below"),React.createElement("div",{className:""+AdminStyles.InvoiceContainer,style:{marginBottom:"2rem",position:"relative"}},React.createElement("div",{className:""+AdminStyles.InvoiceInternalContainer},-1<["paid"].indexOf(s?.status)?React.createElement("div",{className:""+AdminStyles.PaidStamp},"Paid"):null,React.createElement("div",null,React.createElement("div",{className:""+AdminStyles.Entity,style:{marginBottom:".5rem"}},s?.data?.payeeEntity??" "),React.createElement("div",null,s?.data?.address??" "),React.createElement("div",{className:"flex gap-p2"},React.createElement("div",null,s?.data?.payeeCity?s.data.payeeCity+", ":" "),React.createElement("div",null,s?.data?.payeeState??" "),React.createElement("div",null,s?.data?.payeePostalCode??" ")),React.createElement("div",null,s?.data?.payeeCountry??" "),React.createElement("div",{className:"flex gap-p2"},React.createElement("div",null,s?.data?.payeeNumber??" "),React.createElement("div",null,s?.data?.payeeNumber&&s?.data?.payeeWebsite?"|":" "),React.createElement("div",null,s?.data?.payeeWebsite??" "))),React.createElement("div",{className:""+AdminStyles.QuoteContainer},React.createElement("div",{className:""+AdminStyles.InvoiceLabel},"INVOICE"),React.createElement("div",null,React.createElement("div",{className:"flex",style:{justifyContent:"space-between",marginLeft:"25%"}},React.createElement("div",null,"Invoice #"),React.createElement("div",null,s?.id??" ")),React.createElement("div",{className:"flex",style:{justifyContent:"space-between",marginLeft:"25%"}},React.createElement("div",null,"Date"),React.createElement("div",null,s?.simpleData?.dateIssued?new Date(s.simpleData.dateIssued).toLocaleDateString()+" "+new Date(s.simpleData.dateIssued).toTimeString():" ")))),React.createElement("div",{className:"flex gap-p2",style:{justifyContent:"space-between"}},React.createElement("div",null,React.createElement("div",{style:{fontWeight:"600"}},"Bill To"),React.createElement("div",null,s?.data?.payerEntity?s.data.payerEntity.toUpperCase():""),React.createElement("div",{className:"flex gap-p2"},React.createElement("div",null,s?.data?.payerCity?s.data.payerCity+", ":""),React.createElement("div",null,s?.data?.payerState??""),React.createElement("div",null,s?.data?.payerPostalCode??"")),React.createElement("div",null,s?.data?.payerCountry??""),React.createElement("div",{className:"flex gap-p2"},s?.data?.payerNumber?React.createElement("div",null,s?.data?.payerNumber):null,s?.data?.payerNumber&&s?.data?.payerWebsite?React.createElement("div",null,s?.data?.payerNumber&&s?.data?.payerWebsite?"|":""):null,React.createElement("div",null,s?.data?.payerWebsite??" "))),s?.simpleData?.total&&s?.data?.currency?React.createElement("div",null,React.createElement("div",{style:{marginBottom:".25rem"}},"TOTAL AMOUNT DUE IN ",s.data.currency),React.createElement("div",{style:{fontSize:"2rem",textAlign:"right",fontWeight:"600",background:"blue",color:"white"}},"$ ",westernMoneyFormat.format(s.simpleData.total))):null),React.createElement("div",{className:""+AdminStyles.DetailTableContainer},React.createElement("table",{className:""+AdminStyles.DetailTable},React.createElement("tr",null,React.createElement("th",null,"Details"),React.createElement("th",null,"Rate"),React.createElement("th",null,"Qty"),React.createElement("th",null,"Line Total")),s?.simpleData?.table?s.simpleData.table.map((e,t)=>React.createElement("tr",{key:t},React.createElement("td",{className:""+AdminStyles.DescriptionContainer},e.description," ",e.customerCharged?`| $${westernMoneyFormat.format(e.customerCharged)} USD was processed this period`:""),React.createElement("td",{className:""+AdminStyles.TableNumber},e.rate,"/",e.measureBy),React.createElement("td",{className:""+AdminStyles.TableNumber},e.qty.toFixed?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.qty):e.qty),React.createElement("td",{className:""+AdminStyles.TableNumber},e.lineTotal.toFixed?new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e.lineTotal):e.lineTotal))):null)),React.createElement("div",{className:"flex gap-p20",style:{justifyContent:"space-between",marginTop:"1rem"}},React.createElement("div",{style:{width:"100%"}},React.createElement("div",{className:"w600",style:{fontSize:".8rem"}},"Payment Method"),React.createElement("div",{style:{fontSize:".75rem"}},s?.data?.paymentMethod??" "),React.createElement("div",{style:{fontSize:".75rem",marginTop:"1rem"}},s?.data?.payeeNote??" ")),React.createElement("div",{style:{width:"100%"}},React.createElement("div",{className:"flex",style:{justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Subtotal"),React.createElement("div",{className:"w600"},"$ ",s?.simpleData?.subTotal?westernMoneyFormat.format(s.simpleData.subTotal):" ")),React.createElement("div",{className:"flex",style:{justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Tax"),React.createElement("div",{className:"w600"},"$ ",s?.simpleData?.subTotal?westernMoneyFormat.format(s.simpleData.tax):" ")),React.createElement("div",null," "),React.createElement("div",{className:"flex",style:{borderTop:"1px solid black",justifyContent:"space-between",width:"100%"}},React.createElement("div",null,"Total Due"),React.createElement("div",{className:"w600"},"$ ",s?.simpleData?.total?westernMoneyFormat.format(s.simpleData.total):" ")),React.createElement("div",{style:{fontSize:".7rem"}},"(",s?.simpleData?.currency??" ",")"))),React.createElement("div",null,React.createElement("div",{className:""+AdminStyles.millerText,style:{textAlign:"right",fontStyle:"italic"}},s?.data?.paymentThankyou??" "))))):null)))};export default Module;