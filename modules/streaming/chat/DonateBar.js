function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a,o=arguments[t];for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e}).apply(this,arguments)}import React from"react";import ChatStyles from"./Chat.module.scss";import apiReq from"/modules/utility/api/apiReq";import{resolveRegionBasedPrice}from"/modules/utility/ecommerce";import ChatPrompts from"./ChatPrompts";import ChatCommandBar from"/layout/chat/ChatCommandBar";const DEFAULT_PROMPT_STATE={message:"",value:null,amount:"",highlight:"",showing:!1},DEFAULT_POST_FETCH_STATUS={state:"",showing:!1},DEFAULT_FETCH_STATUS={state:""},Module=c=>{const[i,T]=React.useState(!1),[t,l]=React.useState(DEFAULT_FETCH_STATUS),[a,u]=React.useState(DEFAULT_POST_FETCH_STATUS),[d,m]=React.useState(DEFAULT_PROMPT_STATE),h=React.useRef(),_=React.useRef(),g=resolveRegionBasedPrice(c),f=(console.log(g,a),async()=>{let t;try{var a,o,r,n,s;console.log(d),0<d?.value&&!i&&c?.watchMeta?.donateTo&&(t=setTimeout(()=>{T(!1),l({state:""})},35e3),T(!0),l({state:"Sending Donation"}),a=d?.donateTo??c?.watchMeta?.donateTo,o=d?.value,r=d?.offer??c?.offer,n=d?.forLive??c?.watchMeta?.id,console.log(a,o,g),a&&o&&(s=await apiReq("/ecommerce/donate",{identifier:c._loggedIn.identifier,hash:c._loggedIn.hash,donateTo:a,amount:o,offer:r,location:g,options:{extra:{type:c?.regionsData[g.code].payment},forLive:n}}))&&"success"===s.status?(clearTimeout(t),T(!1),u({state:`${g?.symbol??""}${s.data?.totals?.total} ${s.data?.currency} donated to `+(s.data?.meta?.donateToUser??""),header:"Donation sent",href:`https://${c?.domainUrl}/r?o=`+s.data.id,message:"View receipt here",showing:!0}),m(DEFAULT_PROMPT_STATE),setTimeout(()=>{u(DEFAULT_POST_FETCH_STATUS)},1e4),l(DEFAULT_FETCH_STATUS),console.log(s),s?.data?.donation&&e?.currentTarget?.getAttribute("action")&&fireGlobalEvent({action:"donate_complete",donateTo:a,amount:o,offer:r},c._LocalEventEmitter)):(clearTimeout(t),T(!1),l(DEFAULT_FETCH_STATUS)))}catch(e){console.log(e),t&&(clearTimeout(t),T(!1),l(DEFAULT_FETCH_STATUS))}});var o=React.useCallback(e=>{var t,a,o,r,n,s;c?._validCc?(s="customDonate"===e?.currentTarget?.getAttribute("modif")?h?.current?.value:e?.currentTarget?.getAttribute("value")??e?.currentTarget?.value,t=g?.symbol+` ${s} `+g?.currency,a=" to "+(c?.watchMeta?.authorData?.username??"User"),o=c?.watchMeta?.donateTo,r=c?.offer,n=c?.watchMeta?.id,m({header:"Send Donation",message:"Confirm Donation of",value:Number(s),amount:t,highlight:a,showing:!0,confirm:f,donateTo:o,offer:r,forLive:n})):(c._toggleSingleOpenMenu(e,"cart",!0),m({header:"Valid Credit Card required",message:"Please add a Credit Card to send a donation",showing:!0}),_?.current&&clearTimeout(_.current),s=setTimeout(()=>{m(DEFAULT_PROMPT_STATE),_.current=null},5e3),_.current=s)}),r=React.useCallback(e=>{m(DEFAULT_PROMPT_STATE),u(DEFAULT_POST_FETCH_STATUS)});return React.createElement("div",{className:ChatStyles.chatActionBar+" Chat_chatActionBar",style:{background:"#161616"}},React.createElement(ChatPrompts,_extends({},c,{prompt:d,postFetchStatus:a,fetchStatus:t,fetchBusy:i,handlePromptClose:r,handleFireDonate:f})),React.createElement(ChatCommandBar,_extends({},c,{promptDonate:o,customDonate:h})))};export default Module;