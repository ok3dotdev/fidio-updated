function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a,l=arguments[t];for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e}).apply(this,arguments)}import React from"react";import Script from"next/script";import WatchPageStyles from"../WatchPage.module.scss";import{checkPlayerIsPlaying,checkAuthorization}from"/modules/utility/streaming";import{v4 as uuidv4}from"uuid";import{ensureAutoPlay}from"/modules/video/player/utility";import Player from"/modules/streaming/watch/Player";import{initializePlayer}from"/modules/streaming/watch/runtime/initialize";const Module=a=>{const[e,l]=React.useState(!1),[t,r]=React.useState(null),[c,n]=React.useState(null),[i,o]=React.useState(!1),[s,u]=React.useState(!1),[m,p]=React.useState({});var[,,]=React.useState(null);const[d,y]=React.useState(!1);let h=React.useRef();const v=a?.useWatchDataPreview??null,f=(a._LocalEventEmitter.unsubscribe(t),a._LocalEventEmitter.subscribe(t,e=>{if(e&&"loadDefault"===e.dispatch){console.log(h,v?.meta?.streamSettings,i);e=checkPlayerIsPlaying(h)&&!h.current.paused();if(console.log("Player is playing",i,e,d,h.current.paused()),v&&(!i||!e||d)){var t=checkAuthorization(v,null,a,null);if(console.log(t),t&&v?.meta?.channel?.playbackUrl&&(o(t),t)){console.log(v.meta.channel.playbackUrl),h.current.src({src:v.meta.channel.playbackUrl,type:"application/x-mpegURL"}),console.log(e);try{console.log("Attempt Play",h.current),h.current.muted(!0),h.current.play(),y(!1)}catch(e){console.log("err",e)}}}}}),()=>{l((new Date).getTime());var e=uuidv4();r(e);const t="preview-player-"+e;n(t);e=Object.assign(m,{autoplay:!0,playerName:t,id:e});p(e),setTimeout(()=>{try{P(m,t)}catch(e){}},150)}),g=(React.useEffect(()=>{!e&&window?.videojs&&f()},[e,h.current,window?.videojs]),e=>{a._LocalEventEmitter.dispatch(t,{dispatch:"loadDefault"}),setInterval(()=>{a._LocalEventEmitter.dispatch(t,{dispatch:"loadDefault"})},7500)}),P=e=>{var t;window.videojs&&(t=window.videojs.players)&&Object.keys(t).length&&t[e.playerName]&&t[e.playerName].dispose()};return React.useEffect(()=>{!s&&m?.playerName&&document.getElementById(c)&&(h.current=initializePlayer(a,v,null,m?.playerName,m,h,[],null,null,u,g,null))},[s,c,m]),React.createElement("div",null,React.createElement(Script,{src:"https://d2zsu4v7czjhvo.cloudfront.net/all/videojs/8.9.0/video.min.js",onLoad:f}),React.createElement("div",{className:"Watch_PreviewExternalContainer"},React.createElement("h4",{className:"Watch_PreviewLabel"},"Preview"),c?React.createElement(Player,_extends({},a,{className:"Watch_PreviewContainer",playerName:c,playerInitialized:s,usePlayerHeight:"auto"})):null))};export default Module;