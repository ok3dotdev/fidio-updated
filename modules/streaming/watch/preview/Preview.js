function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a,r=arguments[t];for(a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}import React from"react";import Script from"next/script";import WatchPageStyles from"../WatchPage.module.scss";import{checkPlayerIsPlaying,checkAuthorization}from"/modules/utility/streaming";import{v4 as uuidv4}from"uuid";import{ensureAutoPlay}from"/modules/video/player/utility";import Player from"/modules/streaming/watch/Player";const Module=r=>{const[e,o]=React.useState(!1),[t,l]=React.useState(null),[a,c]=React.useState(null),[n,s]=React.useState(!1);var[,,]=React.useState(null);const[i,u]=React.useState(-1),[m,d]=React.useState(!1);let p=React.useRef();const y=r?.useWatchDataPreview??null,v=(console.log(i,y),r._LocalEventEmitter.unsubscribe(t),r._LocalEventEmitter.subscribe(t,e=>{if(e&&"loadDefault"===e.dispatch){console.log(p,y?.meta?.streamSettings,n);e=checkPlayerIsPlaying(p);if(y&&(!n||!e||m)){var t=checkAuthorization(y,null,r,null);if(console.log(t),t&&y?.meta?.channel?.playbackUrl&&(s(t),t)){p.current.src({src:y.meta.channel.playbackUrl,type:"application/x-mpegURL"});if(console.log(i,i<(new Date).getTime()-15e3,e),-1===i||i<(new Date).getTime()-15e3){u((new Date).getTime());try{ensureAutoPlay(p.current.play,p.current),d(!1)}catch(e){console.log("err",e)}}}}}}),()=>{o((new Date).getTime());const e=uuidv4();l(e);var t="preview-player-"+e;c(t);const a={playerName:t,id:e};setInterval(()=>{r._LocalEventEmitter.dispatch(e,{dispatch:"loadDefault"})},5e3),setTimeout(()=>{try{h(a)}catch(e){}},150)}),h=(React.useEffect(()=>{console.log(window,e),!e&&window?.videojs&&v()},[e,p.current,window?.videojs]),e=>{var t;!p.current&&window.videojs&&((t=window.videojs.players)&&Object.keys(t).length&&t[e.playerName]&&t[e.playerName].dispose(),p.current=window.videojs(e.playerName,e,async function(){window.videojs.log("Your player is ready!"),console.log(p.current),this.on("error",e=>{console.log("err",e),d(!0)}),ensureAutoPlay(this.play,this)}))});return React.createElement("div",null,React.createElement(Script,{src:"https://d2zsu4v7czjhvo.cloudfront.net/all/videojs/8.9.0/video.min.js",onLoad:v}),React.createElement("div",{className:"Watch_PreviewExternalContainer"},React.createElement("h4",{className:"Watch_PreviewLabel"},"Preview"),React.createElement(Player,_extends({},r,{className:"Watch_PreviewContainer",playerName:a,usePlayerHeight:"auto"}))))};export default Module;