import{handleInteractMedia}from"/modules/util";import{HMSDurationToSeconds}from"/modules/utility/utility/date";const disposePlayer=e=>{try{var t;window?.videojs?.players&&(t=window.videojs.players)&&Object.keys(t).length&&t[e]&&t[e].dispose()}catch(e){}},setTimeline=(i,e)=>{console.log(i,e,window?.VTTCue);try{if(i&&e?.timeline&&window?.VTTCue){const a=i.addRemoteTextTrack({kind:"metadata",mode:"showing"},!1).track,l=e.timeline.filter(e=>"clip"===e.type),r=e?.duration?HMSDurationToSeconds(e.duration):0,d=i?.controlBar?.progressControl?.el();l.forEach((e,t)=>{var n=e.startOffset,o=e?.endOffset??(l[t+1]&&l[t+1].startOffset)?l[t+1].startOffset-1:r??0,e=e.name,o=new window.VTTCue(n,o,e);a.addCue(o),d&&i?.id_&&(0===t&&((e=document.createElement("div")).className="segmentContainer",e.id=i.id_+"_segmentContainer",d.appendChild(e)),(o=document.getElementById(i.id_+"_segmentContainer"))&&((t=document.createElement("div")).classList.add("vjs-segment-square"),e=n/r*100,t.style.left=e+"%",o.appendChild(t)),console.log("Seek",d))}),i.on("timeupdate",function(){})}}catch(e){}},initializePlayer=(o,i,a,l,e,r,d=[],s,c,m,y,u)=>{console.log(document.getElementById(l));try{if(window.videojs){if(console.log("Run Init",l,document.getElementById(l)),!window.videojs.players[l]||e.force)return window.videojs(l,e,async function(){if(r?.current){m&&m(!0),window.videojs.log(`Your player ${l} is ready!`),console.log(r.current);for(let e=0;e<d.length;e++){var t=r.current.controlBar.addChild("button"),n=t.el();n.innerHTML=d[e].innerHTML??"",d[e].className&&t.addClass(d[e].className),d[e].btnEvent&&(n.removeEventListener("click",d[e].btnEvent),n.addEventListener("click",d[e].btnEvent))}this.on("error",e=>{console.log("Error",l),s&&s()}),this.on("ready",e=>{i?.id&&o&&a?.trying&&(handleInteractMedia(o,o.watchData,a.trying),setTimeline(this,i)),y&&y(e?.target?.player??this,i)}),this.on("play",e=>{u&&u(!0)}),this.on("ended",e=>{console.log("Ended",l),c&&c()})}});if(console.log(`Player ${l} already initialized`),document.getElementById(l)){const t=document.getElementById(l);if(!t?.player?.hasStarted())try{t.player.play(),setTimeout(()=>{t.player.hasStarted()||(t.player.muted(!0),t.player.play())})}catch(e){console.log("Failed to play",e)}}}}catch(e){}};export{disposePlayer,initializePlayer};